{% extends "hero_builder/base.html" %}

{% block title %}{{ hero.display_name }} - Hero Builder{% endblock %}

{% block extra_styles %}
<style>
    .builder-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }

    .builder-header {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .builder-title {
        font-size: 1.8rem;
        color: #fff;
        font-weight: bold;
    }

    .pick-hero-btn {
        background: #1e2530;
        border: 1px solid #3a4555;
        color: #8899aa;
        padding: 8px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
        text-decoration: none;
    }

    .pick-hero-btn:hover {
        background: #2a3545;
        border-color: #5a6575;
    }

    /* Main content area */
    .builder-content {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* Hero Card */
    .hero-card {
        background: #1a1f28;
        border: 1px solid #2a3545;
        border-radius: 12px;
    }

    /* Hero Header - Portrait + Name + Stats + Skills */
    .hero-header {
        display: flex;
        border-bottom: 1px solid #2a3545;
    }

    /* Portrait Column */
    .portrait-column {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        border-right: 1px solid #2a3545;
    }

    .hero-portrait-wrapper {
        position: relative;
        width: 150px;
        height: 150px;
    }

    .hero-portrait {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #3a4555;
    }

    .class-badge {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 2px solid #c9a227;
    }

    /* Info Column */
    .info-column {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    /* Name Row */
    .name-row {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px 20px;
        border-bottom: 1px solid #2a3545;
    }

    .faction-badge {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        border: 1px solid #3a4555;
        padding: 4px;
        background: #252d38;
    }

    .name-text {
        display: flex;
        flex-direction: column;
    }

    .hero-name {
        font-size: 1.5rem;
        font-weight: bold;
        color: #fff;
    }

    .hero-class {
        color: #8899aa;
        font-size: 0.95rem;
        text-transform: capitalize;
    }

    /* Stats + Skills Row */
    .stats-skills-row {
        display: flex;
        padding: 15px 20px;
        gap: 30px;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px 24px;
        align-content: center;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .stat-icon {
        width: 22px;
        height: 22px;
    }

    .stat-value {
        color: #fff;
        font-weight: 500;
        font-size: 1rem;
    }

    /* Skills Grid - 4 columns, 2 rows */
    .skills-grid {
        display: grid;
        grid-template-columns: repeat(4, auto);
        gap: 10px;
        flex: 1;
    }

    /* Skill Slot with 2 Subskill buttons stacked */
    .skill-with-subs {
        display: flex;
        gap: 4px;
    }

    .skill-main {
        width: 60px;
        height: 60px;
        background: #252d38;
        border: 1px solid #3a4555;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        cursor: pointer;
        transition: all 0.15s;
    }

    .skill-main:hover {
        border-color: #5a7090;
        background: #2a3545;
    }

    .skill-main img {
        width: 52px;
        height: 52px;
        border-radius: 6px;
    }

    /* Skill tooltip - uses shared .tooltip-content from components.css */

    .skill-add-text {
        color: #5a6575;
        font-size: 1.5rem;
        font-weight: 300;
    }

    .skill-main:hover .skill-add-text {
        color: #8899aa;
    }

    /* 2 Subskill buttons stacked vertically */
    .subskill-column {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 4px;
    }

    .subskill-btn {
        width: 28px;
        height: 28px;
        background: #252d38;
        border: 1px solid #3a4555;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.15s;
    }

    .subskill-btn:hover {
        border-color: #5a7090;
        background: #2a3545;
    }

    .subskill-btn.disabled {
        opacity: 0.4;
        cursor: default;
    }

    .subskill-btn .add-text {
        color: #5a6575;
        font-size: 0.85rem;
    }

    .subskill-btn:hover .add-text {
        color: #8899aa;
    }

    .subskill-btn img {
        width: 22px;
        height: 22px;
        border-radius: 4px;
    }

    /* Equipment + Backpack Row */
    .equip-spells-row {
        display: flex;
        gap: 15px;
    }

    /* Equipment Section - flexbox rows around hero silhouette */
    .equipment-section {
        background: #1a1f28;
        border: 1px solid #2a3545;
        border-radius: 12px;
        padding: 1rem;
    }

    .equipment-silhouette {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    /* Each row: 3 columns with space-between */
    .equip-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    /* Left/Right columns align to edges, center is centered */
    .equip-col-left,
    .equip-col-right {
        flex: 0 0 auto;
    }

    .equip-col-center {
        flex: 0 0 auto;
        margin: 0 1rem 0 1rem;
    }

    /* Center offset - pushes center item down slightly */
    .offset-down {
        margin-top: 2rem;
    }

    /* Empty placeholder for rows without center item */
    .equip-col-empty {
        visibility: hidden;
    }

    .equip-slot {
        width: 3.5rem;
        height: 3.5rem;
        background: #252d38;
        border: 1px solid #3a4555;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.15s;
        margin: 0.5rem;
    }

    .equip-slot:hover {
        border-color: #5a7090;
    }

    .equip-slot img {
        width: 70%;
        height: 70%;
        opacity: 0.35;
    }

    .equip-slot:hover img {
        opacity: 0.5;
    }

    /* Backpack Section (4x6 grid) */
    .backpack-section {
        background: #1a1f28;
        border: 1px solid #2a3545;
        border-radius: 12px;
        padding: 15px;
        flex: 1;
    }

    .backpack-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }

    .backpack-slot {
        width: 55px;
        height: 55px;
        background: #252d38;
        border: 1px solid #3a4555;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.15s;
    }

    .backpack-slot:hover {
        border-color: #5a7090;
    }

    .backpack-slot .add-text {
        color: #5a6575;
        font-size: 1.2rem;
    }

    .backpack-slot:hover .add-text {
        color: #8899aa;
    }

    /* Units Section */
    .units-section {
        background: #1a1f28;
        border: 1px solid #2a3545;
        border-radius: 12px;
        padding: 15px;
    }

    .units-grid {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    .unit-slot {
        width: 75px;
        height: 75px;
        background: #252d38;
        border: 1px solid #3a4555;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.15s;
    }

    .unit-slot:hover {
        border-color: #5a7090;
    }

    .unit-slot .add-text {
        color: #5a6575;
        font-size: 1.3rem;
    }

    .unit-slot:hover .add-text {
        color: #8899aa;
    }

    /* Right Skill Panel */
    .right-skills-panel {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .right-skill-slot {
        width: 55px;
        height: 55px;
        background: #252d38;
        border: 1px solid #3a4555;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.15s;
    }

    .right-skill-slot:hover {
        border-color: #5a7090;
    }

    .right-skill-slot .add-text {
        color: #5a6575;
        font-size: 1.2rem;
    }

    .right-skill-slot:hover .add-text {
        color: #8899aa;
    }

    /* Main + Sidebar layout */
    .main-with-sidebar {
        display: flex;
        gap: 12px;
    }

    .main-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* Responsive */
    @media (max-width: 900px) {
        .hero-header {
            flex-direction: column;
        }
        .portrait-column {
            border-right: none;
            border-bottom: 1px solid #2a3545;
        }
        .stats-skills-row {
            flex-direction: column;
        }
        .skills-grid {
            grid-template-columns: repeat(2, auto);
        }
        .equip-spells-row {
            flex-direction: column;
        }
        .main-with-sidebar {
            flex-direction: column;
        }
        .right-skills-panel {
            flex-direction: row;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="builder-container">
    <div class="builder-header">
        <h1 class="builder-title">Hero Builder</h1>
        <a href="{% url 'hero_builder:faction_heroes' hero.faction.slug %}" class="pick-hero-btn">Pick Hero</a>
    </div>

    <div class="main-with-sidebar">
        <div class="main-column">
            <!-- Hero Card -->
            <div class="hero-card">
                <div class="hero-header">
                    <!-- Portrait Column -->
                    <div class="portrait-column">
                        <div class="hero-portrait-wrapper">
                            {% if hero.portrait_url %}
                            <img src="{{ hero.portrait_url }}" alt="{{ hero.display_name }}" class="hero-portrait">
                            {% else %}
                            <div class="hero-portrait" style="background: linear-gradient(180deg, #333 0%, #222 100%);"></div>
                            {% endif %}
                        </div>
                        <img src="{{ hero.class_icon_url }}" alt="{{ hero.class_type }}" class="class-badge">
                    </div>

                    <!-- Info Column -->
                    <div class="info-column">
                        <!-- Name Row -->
                        <div class="name-row">
                            <img src="{{ hero.faction.icon_url }}" alt="{{ hero.faction.name }}" class="faction-badge">
                            <div class="name-text">
                                <span class="hero-name">{{ hero.display_name }}</span>
                                <span class="hero-class">{{ hero.specialization_name|default:hero.class_type }}</span>
                            </div>
                        </div>

                        <!-- Stats + Skills Row -->
                        <div class="stats-skills-row">
                            <!-- Stats Grid -->
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <img src="/media/gamedata/ui/stat_attack.png" alt="ATK" class="stat-icon">
                                    <span class="stat-value">{{ hero.start_offence }}</span>
                                </div>
                                <div class="stat-item">
                                    <img src="/media/gamedata/ui/stat_defence.png" alt="DEF" class="stat-icon">
                                    <span class="stat-value">{{ hero.start_defence }}</span>
                                </div>
                                <div class="stat-item">
                                    <img src="/media/gamedata/ui/stat_spellpower.png" alt="PWR" class="stat-icon">
                                    <span class="stat-value">{{ hero.start_spell_power }}</span>
                                </div>
                                <div class="stat-item">
                                    <img src="/media/gamedata/ui/stat_spellpower.png" alt="KNW" class="stat-icon" style="filter: hue-rotate(180deg);">
                                    <span class="stat-value">{{ hero.start_intelligence }}</span>
                                </div>
                                <div class="stat-item">
                                    <img src="/media/gamedata/ui/stat_luck.png" alt="LCK" class="stat-icon">
                                    <span class="stat-value">{{ hero.start_luck }}</span>
                                </div>
                                <div class="stat-item">
                                    <img src="/media/gamedata/ui/stat_morale.png" alt="MRL" class="stat-icon">
                                    <span class="stat-value">{{ hero.start_moral }}</span>
                                </div>
                            </div>

                            <!-- Skills Grid (4 columns, 2 rows) -->
                            <div class="skills-grid">
                                {% for skill in hero.starting_skills_with_levels %}
                                <!-- Skill with 2 stacked subskill slots -->
                                <div class="skill-with-subs">
                                    <div class="skill-main tooltip-wrapper" id="skill-{{ forloop.counter }}" data-skill-id="{{ skill.id }}" data-skill-level="{{ skill.level }}">
                                        <img src="/media/gamedata/skills/{{ skill.id }}{{ skill.icon_suffix }}.png" alt="{{ skill.level_prefix }}{{ skill.name }}">
                                        <div class="tooltip-content">
                                            <div class="tooltip-name">{{ skill.level_prefix }}{{ skill.name }}</div>
                                            {% if skill.description %}
                                            <div class="tooltip-desc">{{ skill.description }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="subskill-column">
                                        <div class="subskill-btn">
                                            <span class="add-text">+</span>
                                        </div>
                                        <div class="subskill-btn disabled"></div>
                                    </div>
                                </div>
                                {% endfor %}

                                <!-- Empty skill slots to fill first row (4 total) -->
                                {% with hero.starting_skills_with_levels|length as skill_count %}
                                {% if skill_count < 4 %}
                                {% for i in "1234"|make_list %}
                                {% if forloop.counter > skill_count %}
                                <div class="skill-with-subs">
                                    <div class="skill-main">
                                        <span class="skill-add-text">+</span>
                                    </div>
                                    <div class="subskill-column">
                                        <div class="subskill-btn disabled"></div>
                                        <div class="subskill-btn disabled"></div>
                                    </div>
                                </div>
                                {% endif %}
                                {% endfor %}
                                {% endif %}
                                {% endwith %}

                                <!-- Second row - 4 empty slots -->
                                {% for i in "1234"|make_list %}
                                <div class="skill-with-subs">
                                    <div class="skill-main">
                                        <span class="skill-add-text">+</span>
                                    </div>
                                    <div class="subskill-column">
                                        <div class="subskill-btn disabled"></div>
                                        <div class="subskill-btn disabled"></div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Equipment + Backpack Row -->
            <div class="equip-spells-row">
                <!-- Equipment - 5 rows around hero silhouette -->
                <div class="equipment-section" id="equipment-panel">
                    <div class="equipment-silhouette">
                        <!-- Row 1: Unique, Head (offset down), Back -->
                        <div class="equip-row">
                            <div class="equip-col-left">
                                <div class="equip-slot" id="slot-unique" data-slot-type="unique">
                                    <img src="/media/gamedata/ui/slot_unique.png" alt="Unique">
                                </div>
                            </div>
                            <div class="equip-col-center offset-down">
                                <div class="equip-slot" id="slot-head" data-slot-type="head">
                                    <img src="/media/gamedata/ui/slot_head.png" alt="Head">
                                </div>
                            </div>
                            <div class="equip-col-right">
                                <div class="equip-slot" id="slot-back" data-slot-type="back">
                                    <img src="/media/gamedata/ui/slot_cloak.png" alt="Back">
                                </div>
                            </div>
                        </div>

                        <!-- Row 2: Ring, Armor, Ring -->
                        <div class="equip-row">
                            <div class="equip-col-left">
                                <div class="equip-slot" id="slot-ring-1" data-slot-type="ring">
                                    <img src="/media/gamedata/ui/slot_ring.png" alt="Ring">
                                </div>
                            </div>
                            <div class="equip-col-center">
                                <div class="equip-slot" id="slot-armor" data-slot-type="armor">
                                    <img src="/media/gamedata/ui/slot_armor.png" alt="Armor">
                                </div>
                            </div>
                            <div class="equip-col-right">
                                <div class="equip-slot" id="slot-ring-2" data-slot-type="ring">
                                    <img src="/media/gamedata/ui/slot_ring.png" alt="Ring">
                                </div>
                            </div>
                        </div>

                        <!-- Row 3: Weapon, Belt, Shield -->
                        <div class="equip-row">
                            <div class="equip-col-left">
                                <div class="equip-slot" id="slot-weapon" data-slot-type="weapon">
                                    <img src="/media/gamedata/ui/slot_left_hand.png" alt="Weapon">
                                </div>
                            </div>
                            <div class="equip-col-center">
                                <div class="equip-slot" id="slot-belt" data-slot-type="belt">
                                    <img src="/media/gamedata/ui/slot_belt.png" alt="Belt">
                                </div>
                            </div>
                            <div class="equip-col-right">
                                <div class="equip-slot" id="slot-shield" data-slot-type="shield">
                                    <img src="/media/gamedata/ui/slot_right_hand.png" alt="Shield">
                                </div>
                            </div>
                        </div>

                        <!-- Row 4: Accessory, (empty), Accessory -->
                        <div class="equip-row">
                            <div class="equip-col-left offset-down">
                                <div class="equip-slot" id="slot-accessory-1" data-slot-type="accessory">
                                    <img src="/media/gamedata/ui/slot_item.png" alt="Accessory">
                                </div>
                            </div>
                            <div class="equip-col-center equip-col-empty">
                                <div class="equip-slot"></div>
                            </div>
                            <div class="equip-col-right offset-down">
                                <div class="equip-slot" id="slot-accessory-2" data-slot-type="accessory">
                                    <img src="/media/gamedata/ui/slot_item.png" alt="Accessory">
                                </div>
                            </div>
                        </div>

                        <!-- Row 5: Accessory, Boots, Accessory -->
                        <div class="equip-row">
                            <div class="equip-col-left">
                                <div class="equip-slot" id="slot-accessory-3" data-slot-type="accessory">
                                    <img src="/media/gamedata/ui/slot_item.png" alt="Accessory">
                                </div>
                            </div>
                            <div class="equip-col-center">
                                <div class="equip-slot" id="slot-boots" data-slot-type="boots">
                                    <img src="/media/gamedata/ui/slot_boots.png" alt="Boots">
                                </div>
                            </div>
                            <div class="equip-col-right">
                                <div class="equip-slot" id="slot-accessory-4" data-slot-type="accessory">
                                    <img src="/media/gamedata/ui/slot_item.png" alt="Accessory">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backpack Grid (4x6) -->
                <div class="backpack-section">
                    <div class="backpack-grid">
                        {% for i in "123456789012345678901234"|make_list %}
                        <div class="backpack-slot">
                            <span class="add-text"></span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Units Row -->
            <div class="units-section">
                <div class="units-grid">
                    {% for i in "1234567"|make_list %}
                    <div class="unit-slot">
                        <span class="add-text">+</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Right Skills Panel -->
        <div class="right-skills-panel">
            {% for i in "12345678"|make_list %}
            <div class="right-skill-slot">
                <span class="add-text">+</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
